var sdk=function(t){var n,e,r;!function(t){t.JSCondition="jsCondition",t.JSFunction="jsFunction",t.JSEvent="jsEvent",t.Selector="selector",t.ElementEvent="elementEvent",t.PageLoad="pageLoad",t.Timeout="timeout",t.Inactivity="inactivity",t.ExitIntent="exitIntent",t.Conjunction="conjunction"}(n||(n={})),function(t){t[t.PAUSED=4]="PAUSED"}(e||(e={})),function(t){t[t.LOCAL=0]="LOCAL",t[t.STAGE=1]="STAGE",t[t.PROD=2]="PROD",t[t.TEST=3]="TEST"}(r||(r={}));var i="lmi_preview";window.addEventListener("load",function(){setTimeout(function(){},2e3)});var o={utm_source:"source",utm_medium:"medium",utm_campaign:"campaign",utm_term:"term",utm_content:"content"};function c(t,n){void 0===n&&(n=20);var e=0;return function(){var r=arguments;clearTimeout(e),e=setTimeout(function(){return t.apply(void 0,[].slice.call(r))},n)}}var a,u=function(){try{return Promise.resolve(s(function(){return!!d(function(){return window.loomi.jitsu})},!0===d(function(){return window.vslyDeferResources})?1e3:500,120)).then(function(){return d(function(){return window.loomi.jitsu})})}catch(t){return Promise.reject(t)}};function s(t,n,e,r){return void 0===n&&(n=500),void 0===e&&(e=4),new Promise(function(i,o){t()?i(0):0!==e?setTimeout(function(){r&&r()&&o("condition rejected "+d(function(){return t.toString()})),s(t,n,e-1).then(i).catch(o)},n):o("condition rejected "+d(function(){return t.toString()}))})}function l(t){return d(function(){return t.toString()},"")}function d(t,n){void 0===n&&(n=void 0);try{return t()}catch(t){return n}}function f(t,n,e){void 0===n&&(n=5),void 0===e&&(e=500),n>=0&&!d(t)&&setTimeout(function(){d(t)||f(t,n-1)},e)}function m(){window.loomi_ctx=window.loomi_ctx||{}}function p(t){window.loomi_ctx.tagIds=window.loomi_ctx.tagIds||new Set,t.forEach(function(t){return window.loomi_ctx.tagIds.add(t)}),window.loomi_ctx.gtags=window.loomi_ctx.gtags||[]}function h(t){return t.replace(/[^a-z_A-Z0-9]/gi,"_")}function v(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function w(){return w=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)({}).hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},w.apply(null,arguments)}var y,g={DEBUG:{name:"DEBUG",severity:10},INFO:{name:"INFO",severity:100},WARN:{name:"WARN",severity:1e3},ERROR:{name:"ERROR",severity:1e4},NONE:{name:"NONE",severity:1e4}};function _(){return y||(t=d(function(){return window.location.search.includes("lmi_debug")})?g.WARN:g.NONE,n={minLogLevel:t},Object.values(g).forEach(function(e){var r=e.name,i=e.severity;n[r.toLowerCase()]=function(){var n=[].slice.call(arguments);if(i>=t.severity&&n.length>0&&"NONE"!=t.name){var e,o=n[0],c=n.splice(1),a="[VSLY-"+r+"] "+o;if("DEBUG"===r||"INFO"===r)(e=console).log.apply(e,[a].concat(c));else if("WARN"===r){var u;(u=console).warn.apply(u,[a].concat(c))}else{var s;(s=console).error.apply(s,[a].concat(c))}}}}),y=n);var t,n}function S(){try{return!!d(function(){return d(function(){return new URL(window.location.href).searchParams.get(i)})||sessionStorage.getItem(i)})}catch(t){return _().error("failed getting lmi_preview for preview"),!1}}function P(t){return d(function(){return window.visually.flags[t]},!1)}var E=/*#__PURE__*/function(){function t(t,n,e,r){this.env=void 0,this.version=void 0,this.storeAlias=void 0,this.anonymousUserId=void 0,this.env=t,this.version=n,this.storeAlias=e,this.anonymousUserId=r}return t.prototype.withScript=function(t){var n=this;return function(e,i){if(!P("kill-logs")&&(n.env===r.PROD||n.env===r.STAGE)){i&&_().error(t,i,e);var o={userId:t+"_"+n.version+"_"+n.storeAlias+"_"+n.anonymousUserId,message:e+" host: "+location.hostname+" path: "+location.pathname};return fetch("https://logs.loomi-"+(n.env==r.STAGE?"stg":"prod")+".xyz/6087fbd0-8017-4c6b-bb36-67c2efdf2a57/logs",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json; charset=UTF-8"}})}}},t}(),k=function(t,n){void 0===n&&(n=8397271938200529);for(var e,r=3735928559^n,i=1103547991^n,o=0;o<t.length;o++)e=t.charCodeAt(o),r=Math.imul(r^e,2654435761),i=Math.imul(i^e,1597334677);return r=Math.imul(r^r>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),""+(4294967296*(2097151&(i=Math.imul(i^i>>>16,2246822507)^Math.imul(r^r>>>13,3266489909)))+(r>>>0))},I="lmi_utm_data";function A(){var t,n,e,r,i=(t=function(t){if(function(t){return!t||"{}"===JSON.stringify(t)}(t))return null;var n={};return t.campaign&&(n.campaign=t.campaign),t.medium&&(n.medium=t.medium),t.source&&(n.source=t.source),t.term&&(n.term=t.term),t.content&&(n.content=t.content),n}(d(function(){return function(t){var n={utm:{}};for(var e in t)if(t.hasOwnProperty(e)){var r=o[e];r&&(n.utm[r]=t[e])}return n}(function(){for(var t=window.location.search.substring(1),n={},e=("?"===t[0]?t.substr(1):t).split("&"),r=0;r<e.length;r++){var i=e[r].split("=");n[decodeURIComponent(i[0])]=decodeURIComponent(i[1]||"")}return n}()).utm})),n=[],null!=(e=localStorage.getItem(I))&&(n=[].concat(JSON.parse(e)).slice(0,20)),t&&(t.ts=new Date,n=[t].concat(n)),r=n,localStorage.setItem(I,JSON.stringify(r)),r);return d(function(){return i.filter(function(t){return t.campaign}).reduce(function(t,n){return n.ts>t.ts?n:t},i[0]).campaign})||""}var C="vsly_session";function x(){var t={id:k(window.loomi_ctx.storeAlias+window.loomi_ctx.userId+(new Date).valueOf()+A()),utm_campaign:A(),last_interaction:new Date,landing_page:d(function(){return location.href},""),start_at:new Date};return O(t),t}function O(t){var n=JSON.stringify(t);localStorage.setItem(C,n),window.loomi_ctx.session=t}function b(){window.loomi_ctx=window.loomi_ctx||{};var t=window.loomi_ctx.session||d(function(){var t=JSON.parse(localStorage.getItem(C));return t.last_interaction=new Date(t.last_interaction),t.start_at=new Date(t.start_at),t})||x();return function(t){var n=new Date,e=t.last_interaction;return(n.valueOf()-e.valueOf())/6e4>30||A()!==t.utm_campaign||t.last_interaction.getDate()!==n.getDate()}(t)&&(t=x()),window.loomi_ctx.session=t,t}function T(t,n){if(!t&&!n)return!0;if(!t&&n)return!1;if(t&&!n)return!1;var e=Object.keys(t).sort(function(t,n){return t.localeCompare(n)}),r=Object.keys(n).sort(function(t,n){return t.localeCompare(n)});if(e.length!==r.length)return!1;for(var i,o=function(t){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,n){if(t){if("string"==typeof t)return v(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?v(t,n):void 0}}(t))){n&&(t=n);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(i=o()).done;){var c=i.value,a=t[c],u=n[c],s=N(a)&&N(u);if(s&&!T(a,u)||!s&&a!==u)return!1}return!0}function N(t){return null!=t&&"object"==typeof t}var R="lmi_type",j="lmi_from",U="lmi_class";function D(t){return d(function(){return[U,j,R].includes(t)})}var L,q=function(){return Math.random().toString(36).substring(2,7)},G={utm_source:"source",utm_medium:"medium",utm_campaign:"campaign",utm_term:"term",utm_content:"content"},J={gclid:!0,fbclid:!0,dclid:!0};function M(t,n,e,r){void 0===e&&(e=2e3),void 0===r&&(r=5);var i=0,o=0,c=!1;return function(){var a,u,s,l=Date.now();l-i<e?(o+=1)>=r&&!c&&(c=!0,void 0===a&&(a="counter"),void 0===u&&(u="sdk"),void 0===s&&(s="inc"),fetch("https://logs.loomi-prod.xyz/af3a0f80-908b-4602-9c31-535a453d2b3a/collect/"+a+"/"+u+"/"+n+"/"+s,{method:"POST",body:JSON.stringify({alias:window.loomi_ctx.storeAlias}),headers:{"Content-Type":"application/json; charset=UTF-8"}})):o=0,i=l,!c&&t().apply(void 0,[].slice.call(arguments))}}!function(t){t.SIGNUP="SIGNUP",t.ADD_TO_CART="ADD_TO_CART",t.CHANGE_QTY="CHANGE_QTY",t.REMOVE_FROM_CART="REMOVE_FROM_CART",t.PAGE_LOAD="PAGE_LOAD",t.CLICK="CLICK",t.LOGIN="LOGIN",t.LOGOUT="LOGOUT",t.TIME_SPENT="TIME_SPENT",t.USE_CASE="USE_CASE"}(L||(L={}));var H=new Map,F=function(){return edgetag("getUserId")};function B(){var t=b();t.last_interaction=new Date,O(t)}var K=/*#__PURE__*/function(){function t(t,n){this.cookieDomain=void 0,this.cookieName=void 0,this.cookieDomain=t,this.cookieName=n}var n=t.prototype;return n.save=function(t){var n,e,r,i;n=this.cookieName,e=encodeURIComponent(JSON.stringify(t)),r=this.cookieDomain,i="http:"!==document.location.protocol,document.cookie=encodeURIComponent(n)+"="+e+"; path=/; expires=Fri, 31 Dec 9999 23:59:59 GMT"+(r?"; domain="+r:"")+(i?"; secure":"")},n.restore=function(){var t,n=(t=this.cookieName)&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;if(n)try{var e=JSON.parse(decodeURIComponent(n));if("object"!=typeof e)return;return e}catch(t){return}},n.delete=function(){},t}(),V=/*#__PURE__*/function(){function t(){}var n=t.prototype;return n.save=function(t){},n.restore=function(){},n.delete=function(){},t}(),z=/*#__PURE__*/function(){function t(){this.userIdPersistence=void 0,this.propsPersistance=void 0,this.anonymousId="",this.userProperties={},this.permanentProperties={globalProps:{},propsPerEvent:{}},this.cookieDomain="",this.trackingHost="",this.idCookieName="",this.randomizeUrl=!1,this.apiKey="",this.initialized=!1,this.initialOptions=void 0,this.cookiePolicy="keep",this.ipPolicy="keep",this.runningUseCases=new Set,this.getAnalyticsCtx=function(){return{}}}var n=t.prototype;return n.id=function(t,n){return this.userProperties=w({},this.userProperties,t),this.userIdPersistence&&this.userIdPersistence.save(t),n?Promise.resolve():this.track("user_identify",{})},n.makeEvent=function(t,n,e){var r;this.restoreId();var i,o=this.getCtx(),c=(i="vsly_edgetag",f(function(){return F()&&localStorage.setItem(i,F()),!0}),d(F)||localStorage.getItem(i));c&&(o.edgetag=c);var a=w({},this.permanentProperties.globalProps,null!=(r=this.permanentProperties.propsPerEvent[t])?r:{}),u=w({api_key:this.apiKey,src:n,event_type:t},e);return o=function(t,n){try{Object.keys(t).forEach(function(t){if(d(function(){return t.includes("_")})&&t.toUpperCase()===t){var e=d(function(){return t.split("_").map(function(t){return t.toLowerCase()})},[""]);switch(e.length){case 1:d(function(){return n[e[0]]})&&delete n[e[0]];break;case 2:d(function(){return n[e[0]][e[1]]})&&delete n[e[0]][e[1]];break;case 3:d(function(){return n[e[0]][e[1]][e[2]]})&&delete n[e[0]][e[1]][e[2]];break;case 4:d(function(){return n[e[0]][e[1]][e[2]][e[3]]})&&delete n[e[0]][e[1]][e[2]][e[3]]}}})}catch(e){_().error("vsly err code 666:"+l(n)+":"+l(t))}return n}(e,o),w({},a,o,u)},n.sendJson=function(t){var n="keep"!==this.cookiePolicy?"&cookie_policy="+this.cookiePolicy:"",e="keep"!==this.ipPolicy?"&ip_policy="+this.ipPolicy:"",r=this.trackingHost+"/api/v1/event?token="+this.apiKey+n+e;return this.randomizeUrl&&(r=this.trackingHost+"/api."+q()+"?p_"+q()+"="+this.apiKey+n+e),navigator.sendBeacon(r,new Blob([JSON.stringify(t)],{type:"text/plain"})),Promise.resolve()},n.getCtx=function(){var t,n,e=this,r=d(function(){return window.loomi_ctx.audiences}),i=new Date;return w({event_id:"",user:w({anonymous_id:this.anonymousId},this.userProperties),user_agent:navigator.userAgent,utc_time:(t=i.toISOString(),n=t.split(".")[1],n?n.length>=7?t:t.slice(0,-1)+"0".repeat(7-n.length)+"Z":t),local_tz_offset:i.getTimezoneOffset(),url:window.location.href,doc_path:document.location.pathname,doc_host:document.location.hostname,doc_search:window.location.search,alias:window.loomi_ctx.storeAlias},r?{audiences:r.join("|")}:{},{sid:d(function(){return window.loomi_ctx.session.id}),sid_start:d(function(){return window.loomi_ctx.session.start_at.toISOString()})},d(function(){return e.getAnalyticsCtx()},{}),function(){var t=window.Shopify;if(!t)return{};if(!d(function(){return t.checkout}))return{};var n=t.checkout,e={customer_id:d(function(){return n.customer_id.toString()})};return d(function(){return n.order_id})&&(e.order_id=d(function(){return n.order_id.toString()}),e.order_created_at=d(function(){return n.created_at.toString()})),e}(),function(t){var n={utm:{},click_id:{},lmi_params:{}};for(var e in t)if(t.hasOwnProperty(e)){var r=t[e],i=G[e];i?n.utm[i]=r:J[e]?n.click_id[e]=r:D(e)&&(n.lmi_params[e]=decodeURIComponent(r))}return n}(function(){for(var t=window.location.search.substring(1),n={},e=("?"===t[0]?t.substr(1):t).split("&"),r=0;r<e.length;r++){var i=e[r].split("="),o=decodeURIComponent(i[1]||"");o.endsWith("\\")&&(o=o.replace(/.$/,"")),n[decodeURIComponent(i[0])]=o}return n}()))},n.track=function(t,n,e){try{var r=this;return r.skipTracking()?Promise.resolve():Promise.resolve(s(function(){return!!d(function(){return!!window.loomi_ctx.storeAlias&&window.loomi_ctx.session.id})},200)).then(function(){t===L.USE_CASE&&function(t){P("kill-ga")||d(function(){return!t.gaName})||function(t){try{return m(),p(function(){for(var t=document.getElementsByTagName("script"),n=[],e=0;e<t.length;e++)try{var r=t[e];r.src.includes("www.googletagmanager.com/gtag/js")&&n.push(new URL(r.src).searchParams.get("id"))}catch(t){}return n}()),window.loomi_ctx.gtags=[].concat(window.loomi_ctx.gtags,[function(n){var e=h(t.gaName),r=h(t.gaVariant),i=""+n+e+r;H.get(i)||(window.gtag&&H.set(i,!0),d(function(){window.gtag("event","VISUALLY",{EXPERIENCE:e,VARIANT:r,non_interaction:!0,send_to:n})}))}]),d(function(){return"ANDIE_SWIM_1"===window.loomi_ctx.storeAlias})&&window.loomi_ctx.tagIds.add("G-D5DRR8JQ64"),window.loomi_ctx.tagIds.forEach(function(t){window.loomi_ctx.gtags.forEach(function(n){return n(t)})}),Promise.resolve()}catch(t){return Promise.reject(t)}}(t).catch()}(e),d(B);var i=r.makeEvent(t,"jitsu",n||{});return r.sendJson(i).catch(function(t){_().error("tracking failed with err:",t)})})}catch(t){return Promise.reject(t)}},n.skipTracking=function(){if("test"===this.apiKey||S())return!0;if("UNDEROUTFIT"===window.loomi_ctx.storeAlias){var t=d(function(){return window.location.pathname.endsWith("the-comfort-shaping-bra-rp")}),n=d(function(){return"rp"===new URL(window.location.href).searchParams.get("utm_source")});return t||n}return!1},n.init=function(t){if(this.ipPolicy="keep",this.getAnalyticsCtx=t.analyticsContext,t.ip_policy&&(this.ipPolicy=t.ip_policy),t.cookie_policy&&(this.cookiePolicy=t.cookie_policy),"strict"===t.privacy_policy&&(this.ipPolicy="strict",this.cookiePolicy="strict"),"comply"===this.cookiePolicy&&(this.cookiePolicy="strict"),this.initialOptions=t,t.key){if(this.cookieDomain=t.cookie_domain||document.location.hostname.replace("www.",""),this.trackingHost=function(t){for(;(n=t).includes("/",n.length-1);)t=t.substr(0,t.length-1);var n;return 0===t.indexOf("https://")||0===t.indexOf("http://")?t:"//"+t}(t.tracking_host||"t.jitsu.com"),this.randomizeUrl=t.randomize_url||!1,this.idCookieName=t.cookie_name||"__eventn_id",this.apiKey=$(t.key),this.propsPersistance="strict"===this.cookiePolicy?new V:new K(this.cookieDomain,this.idCookieName+"_props"),this.userIdPersistence="strict"===this.cookiePolicy?new V:new K(this.cookieDomain,this.idCookieName+"_usr"),this.propsPersistance){var n,e,r=this.propsPersistance.restore();r&&(this.permanentProperties=r,this.permanentProperties.globalProps=null!=(n=r.globalProps)?n:{},this.permanentProperties.propsPerEvent=null!=(e=r.propsPerEvent)?e:{}),_().debug("",this.permanentProperties)}"strict"!==this.cookiePolicy&&(this.anonymousId="TANAOR_IL"===window.loomi_ctx.storeAlias?d(function(){return window.loomi_ctx.userId.substring(0,10)}):window.loomi_ctx.userId),this.initialized=!0}},n.restoreId=function(){if(this.userIdPersistence){var t=this.userIdPersistence.restore();t&&(this.userProperties=w({},t,this.userProperties))}},n.set=function(t,n){var e=d(function(){return n.eventType}),r=d(function(){return n.persist});if(void 0!==e){var i,o=null!=(i=this.permanentProperties.propsPerEvent[e])?i:{};this.permanentProperties.propsPerEvent[e]=w({},o,t)}else this.permanentProperties.globalProps=w({},this.permanentProperties.globalProps,t);this.propsPersistance&&r&&this.propsPersistance.save(this.permanentProperties)},n.unset=function(t,n){var e=d(function(){return n.eventType}),r=d(function(){return n.persist});e?this.permanentProperties.propsPerEvent[e]&&delete this.permanentProperties.propsPerEvent[e][t]:delete this.permanentProperties.globalProps[t],this.propsPersistance&&r&&this.propsPersistance.save(this.permanentProperties)},n.register=function(t,n,e,r){this.runningUseCases.add({name:t,variant:n,gaName:r,gaVariant:e})},n.getRunningUseCases=function(){return JSON.stringify(Array.from(this.runningUseCases))},n.setAnalyticsContext=function(t){this.getAnalyticsCtx=t},t}();function W(t){switch(t){case r.PROD:return{trackingHost:"jitsu-api.loomi-prod.xyz"};case r.STAGE:case r.LOCAL:return{trackingHost:"jitsu-api.loomi-stg.xyz"};case r.TEST:return{trackingHost:"http://localhost:8088"}}}var Y,$=function(t){return P("ji-small")?"js.ux4ung2maf2gh5lxklpkp.fc64n2iubntb63ae5o2db":t},X="vslyCT",Q="vslySUBS",Z="vslySID",tt="vslyUID";!function(t){t.CART_CHANGE="CART_CHANGE",t.LOYALTY_CHANGE="LOYALTY_CHANGE"}(Y||(Y={}));var nt=c(function(t,n){var e=function(t,n){var e=new Event("targeting-changed");return e.key=t,e.value=n,e}(t,n);document.dispatchEvent(e),console.debug("Targeting has changed:",e)},80);function et(t,n){nt(t,n)}function rt(){var t;(window.location.search.includes("lmi_debug")||d(function(){return window.vsly_fbs}))&&(t=console).error.apply(t,["loomi-editor"].concat([].slice.call(arguments)))}function it(){return s(function(){return d(function(){return!!window.loomi.jitsu})},100,100)}function ot(){if(d(function(){return void 0===window.loomi_ctx.cart})){var t=localStorage.getItem(st);if(t)try{window.loomi_ctx=w({},window.loomi_ctx||{},{cart:JSON.parse(t)})}catch(n){_().error("failed parsing cart",t)}}return d(function(){return window.loomi_ctx.cart})}var ct=function(t,n,e,r,i,o){if(gt(t)){var c=d(function(){return n.toUpperCase()});if("POST"===c){if(At(e,r))it().then(function(){return window.loomi.jitsu.track(L.ADD_TO_CART,Et(r))}),pt(i,e);else if(function(t,n){return t.match(/^\/cart\/change.*/)||t.match(/^\/cart\/update.*/)&&!t.includes("vsly=t")||t.match(/cart\/(change|update)\.(js|json)$/)||!!d(function(){return vt(t,n,["cartlinesupdate","cartlinesremove","cartlineupdate","cartattributesupdate"])})}(e,r)){var a=Et(r),u=function(t){if(d(function(){return!t.qty})||d(function(){return!t.variantId}))return null;var n=d(function(){return ot().items.find(function(n){return n.id==t.variantId||n.variant_id==t.variantId}).quantity});if(!n)return L.CHANGE_QTY;var e=parseInt(t.qty);return 0===e?L.REMOVE_FROM_CART:e===n?null:e>n?L.ADD_TO_CART:L.REMOVE_FROM_CART}(a);u&&it().then(function(){return window.loomi.jitsu.track(u,a)}),pt(i,e)}ht(e)&&mt(lt(i))}else"GET"!==c&&c||function(t){return t.match(/^\/cart\.json.*|^\/cart\.js.*|^\/cart.*/)||t.match(/cart\.(js|json)$/)}(e)&&i&&_t(i)&&mt(i)}},at=c(function(){return document.body.dispatchEvent(new CustomEvent("pdpresp"))},500),ut=function(t,n,e){var r="/products/",i=["/collections/",r];gt(t)&&(e||"").includes(r)&&d(function(){return!!i.find(function(t){return window.location.pathname.includes(t)})})&&!P("kill-pdp-intercept")&&at()},st="loomi-cart";function lt(t){var n=d(function(){return t.data.cartLinesAdd.cart}),e=d(function(){return t.data.cartLinesUpdate.cart}),r=d(function(){return t.data.cartLinesRemove.cart});return function(t){if(void 0!==t)return d(function(){return{item_count:t.totalQuantity,token:t.id.replace("gid://shopify/Cart/",""),total_price:parseFloat(t.cost.totalAmount.amount),currency:t.cost.totalAmount.currencyCode,note:t.note,attributes:t.attributes,items:t.lines.edges.map(function(t){var n=t.node,e=n.merchandise;return{id:n.id,quantity:n.quantity,variant_id:parseInt(e.id.replace("gid://shopify/ProductVariant/","")),handle:e.product.handle,product_id:parseInt(e.product.id.replace("gid://shopify/Product/","")),price:d(function(){return parseFloat(e.priceV2.amount)},d(function(){return parseFloat(e.price.amount)}))}})}})}(d(function(){return t.data.cart})||n||e||r)}var dt=function(t){(function(t,n){var e=d(function(){var t=n.attributes,e=d(function(){return window.loomi_ctx.userId}),r=d(function(){return window.loomi_ctx.session.id},"");return!(!e||!r||t[X]&&t[tt]===e&&t[Z]===r)},!1);try{return void 0!==n&&(!T(t,n)||e)}catch(t){return!0}})(ot(),t)&&(!0===d(function(){return window.visually.flags["sdk-enable-cart-enrichment"]},!1)?function(t){try{var n=function(){return Promise.resolve(t)};if(d(function(){return t.items.length<=0}))return Promise.resolve(t);var e=function(n,e){try{var r=(i=d(function(){return Array.from(t.items.map(function(t){return t.handle}))},[]).map(function(t){return{name:t,oneOf:{productInfo:{handle:t,includeCollections:!0,includeTags:!0}}}}),Promise.resolve(window.loomi_api.allocatorQuery({queries:i})).then(function(n){t.items=t.items.map(function(t){return t.tags=d(function(){return n.results[t.handle].tags},[]),t.collections=d(function(){return n.results[t.handle].collections},[]),t})}))}catch(t){return e(t)}var i;return r&&r.then?r.then(void 0,e):r}(0,function(n){rt("failed to enrich cart with error",n,t)});return Promise.resolve(e&&e.then?e.then(n):n())}catch(t){return Promise.reject(t)}}(t).then(function(t){yt(t),et(Y.CART_CHANGE,d(function(){return window.loomi_ctx.cart}))}):(yt(t),et(Y.CART_CHANGE,d(function(){return window.loomi_ctx.cart}))))},ft=c(dt,400),mt=function(t){!0===d(function(){return window.visually.flags["sdk-enable-cart-change-debounce"]},!1)?ft(t):dt(t)};function pt(t,n){_t(t)&&mt(t),ht(n)&&mt(lt(t)),d(function(){return!n.includes("vsly=t")})&&It()}function ht(t){return t.includes("/api/")&&t.endsWith("graphql.json")}var vt=function(t,n,e){var r="";return!!ht(t)&&(r=function(t){var n="";return"object"==typeof t?n=d(function(){return t.query.toLowerCase()}):"string"==typeof t&&(n=t.toLowerCase()),n}(n),!!e.find(function(t){return r.includes("mutation "+t)}))},wt="loomi-cart-history";function yt(t){(function(t){try{var n=function(t){return d(function(){return t.items.map(function(t){return{price:t.price,variant_id:""+t.variant_id,product_id:""+t.product_id,quantity:t.quantity,timestamp:xt()}})},[])}(t);e=function(t){var n=ot(),e=JSON.parse(localStorage.getItem(wt)||"[]"),r=d(function(){return e.map(function(t){return""+t.variant_id})});return d(function(){return t.forEach(function(t){var i=r.indexOf(""+t.variant_id);i<0?e=[t].concat(e):function(t,n){return d(function(){return t.items.find(function(t){return""+t.variant_id==""+n.variant_id}).quantity<n.quantity})}(n,t)&&(e[i]=w({},t,{timestamp:xt()}),e=e.sort(function(t,n){return Ct(n)-Ct(t)}))})}),e}(n),localStorage.setItem(wt,JSON.stringify(e.slice(0,25)))}catch(t){_().error("handleCartItemsHistory",t)}var e})(t),localStorage.setItem(st,JSON.stringify(t)),window.loomi_ctx=w({},window.loomi_ctx||{},{cart:t})}function gt(t){var n=".myshopify.com";return window.location.hostname==d(function(){return t.split(":")[0]})||d(function(){return t.endsWith(n)})||t===d(function(){return window.loomi_ctx.storeAlias.toLowerCase().replace("_","-")+n})}function _t(t){return d(function(){return void 0!==t.items})&&d(function(){return void 0!==t.total_price})&&d(function(){return void 0!==t.token})}function St(t){return d(function(){return decodeURIComponent(t).split("&").find(function(t){return"id"===t.split("=")[0]}).split("=")[1].split(":")[0]})||d(function(){return kt(t).id})}function Pt(t){return isNaN(Number(t))}function Et(t){var n={},e=function(t){return d(function(){return decodeURIComponent(t).split("&").find(function(t){return"quantity"===t.split("=")[0]}).split("=")[1]})||d(function(){return kt(t).quantity.toString()})}(t),r=St(t);return r&&!Pt(r)||(r="0"),Pt(e)||(n.qty=e),Pt(r)||(n.variantId=r),n}function kt(t){try{return d(function(){return JSON.parse(t).items[0]})}catch(t){return}}function It(){d(function(){return"static"!==window.vslyIntegrationType})||fetch("/cart.json?vsly=t").then(function(){return d(function(){return window.loomi_ctx.cartRefreshed=!0})}).catch()}function At(t,n){return t.match(/^\/cart\/add.*/)||t.match(/cart\/add\.(js|json)$/)||!!d(function(){return vt(t,n,["cartlineadd","cartcreate"])})}function Ct(t){return new Date(t.timestamp).valueOf()}function xt(){return(new Date).toISOString()}function Ot(){var t=window.ShopifyAnalytics;if(!t)return{};try{var n=function(t){return d(function(){return t.meta.product})}(t),e=function(t,n){var e=d(function(){return t.meta.selectedVariantId},"0");return Tt(e)&&function(t,n){return d(function(){return t.variants.find(function(t){return t.id==n})})}(n,e)||(e=function(){try{return new URL("http://"+window.location.pathname+window.location.search).searchParams.get("variant")}catch(t){return _().info("vsly-e: 444"),""}}()),Tt(e)||(e=d(function(){return n.variants[0].id})),function(t){var n=Number(t),e=isNaN(n)?Number((""+t).replace(/[^\d.]+/g,""))||void 0:n;if(void 0!==e)return""+e}(e)}(t,n),r={cartId:bt(t)};return function(t){return d(function(){return!!t.meta.page.pageType})}(t)&&(r.page={pageType:Nt(t)}),d(function(){return!!n.id})&&(r.product={id:d(function(){return n.id.toString()})}),e&&(r.variant={id:e}),void 0!==window.__st&&window.__st.cid&&(r.clientId=(f(function(){var t=new Function(document.querySelector('script[id="__st"]').textContent+";return __st.cid.toString()")();return t&&window.localStorage.setItem("vsly__st",t),!0}),d(function(){return window.__st.cid.toString()})||window.localStorage.getItem("vsly__st"))),r}catch(t){return _().error("vsly-e 555",t),{}}}function bt(t){var n=d(function(){return t.lib.config.initialDocumentCookie}),e=/cart=(.*?);/.exec(n);return d(function(){return function(t){if("string"!=typeof t)return t;var n=t.indexOf('\\"');return-1===n?t:t.slice(0,n)}(e[1])})}function Tt(t){return("string"==typeof t||"number"==typeof t)&&""!==t&&0!==t}function Nt(t){return d(function(){return t.meta.page.pageType.toString()})}var Rt=!1;function jt(t){try{var n=new URL(t);if(Dt(n.hostname)){var e=n.searchParams.get("tid");e&&(m(),p([]),window.loomi_ctx.tagIds.add(e),window.loomi_ctx.gtags&&window.loomi_ctx.gtags.map(function(t){return t(e)}))}}catch(t){}}function Ut(t,n,e,r,i,o){"POST"===n&&Dt(t)&&(e.startsWith("/")&&(e="https://"+t+e),jt(e))}function Dt(t){return t.includes("analytics.google.com")||t.includes("google-analytics.com")}function Lt(t){try{var n=t&&"function"==typeof d(function(){return t.indexOf})&&0==t.indexOf("/")?window.location.origin+t:t,e=n.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),r=e&&e[1]||"";return{domain:r,path:n.replace("https://","").replace(r,"").replace("http://","")}}catch(t){return{domain:"",path:""}}}function qt(t,n,e){try{if(gt(t)&&At(n)){var r=St(e);r&&r!=d(function(){return window.loomi_ctx.last_vid_atc.vid})&&(document.dispatchEvent(new Event("VSLY_PRE_ATC")),window.loomi_ctx.last_vid_atc={vid:r,ts:+new Date})}}catch(t){}}var Gt=[],Jt="loomi_session_products";function Mt(t){localStorage.setItem(Jt,JSON.stringify(t)),window.loomi_ctx=w({},window.loomi_ctx||{},{sessionProducts:t})}var Ht="loomi_purchased_products",Ft=HTMLFormElement.prototype.submit,Bt=(new Date).getTime(),Kt=!1,Vt=function(){return Kt?Promise.resolve():(console.log("vsly-loyalty","Tracking signup"),Kt=!0,u().then(function(){return window.loomi.jitsu.track(L.SIGNUP,{PAGE_LOAD_ID:"i"+Bt})}))};function zt(t,n,e,r,i,o){"POST"===n&&(gt(t)?function(t){return t.endsWith("/account")}(e)&&Vt():function(t){var n=d(function(){return new URL(t)});return!!n&&n.pathname.endsWith("api/public/v1/point_redemptions")}(e)&&document.dispatchEvent(new CustomEvent("vsly:loyalty-changed")))}HTMLFormElement.prototype.submit=function(){var t=this;try{var n=this.getAttribute("action"),e=this.getAttribute("method");"/account"===n&&"post"===e?Vt().then(function(){Ft.call(t)}):Ft.call(this)}catch(t){Ft.call(this)}};var Wt=function(t,n,e,r){try{var i=function(i,o){try{var c=function(){var i=new URLSearchParams;i.append("attributes["+X+"]",t),i.append("attributes["+Q+"]",""+n),e&&i.append("attributes["+tt+"]",""+e),r&&i.append("attributes["+Z+"]",""+r);var o=i.toString();return Promise.resolve(fetch("/cart/update.js?vsly=t",{credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:o,method:"POST",mode:"cors"})).then(function(){})}()}catch(t){return o(t)}return c&&c.then?c.then(void 0,o):c}(0,function(t){rt("vsly cart attr update err",t)});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},Yt=M(function(){return window.visually.updateCartAttributes},"cart_attr_loop");function $t(t){if(!d(function(){return window.visually.flags["kill-cart-attr"]})&&t&&!(d(function(){return t.token.length},0)<=5)){var n=function(t){var n=d(function(){return window.loomi_ctx.session.id}),e=d(function(){return window.loomi_ctx.userId}),r=X+"_"+t.token,i=function(t){return d(function(){return t.items.map(function(t){return d(function(){return t.selling_plan_allocation.selling_plan.name.toLowerCase()})}).filter(function(t){return!!t})},[])}(t).length;return{sid:n,uid:e,vslyCartToken:r,cartSubscriptions:i}}(t),e=n.sid,r=n.uid,i=n.vslyCartToken,o=n.cartSubscriptions,c=d(function(){return t.attributes[X]||""},""),a=d(function(){return t.attributes[Q]||0},0),u=d(function(){return t.attributes[Z]||""},""),s=r!==d(function(){return t.attributes[tt]||""},"")&&!!r,l=e!==u&&!!e;(""+o!=""+a||c!=i&&i||s||l)&&(t.attributes=t.attributes||{},t.attributes[X]=i,t.attributes[Q]=""+o,s&&(t.attributes[tt]=""+r),l&&(t.attributes[Z]=""+e),yt(t),Xt(i,o,r,e))}}c(function(t,n){Yt(t,n)},1e3);var Xt=c(M(function(){return Wt},"cart_attr_loop"),1e3),Qt=c(M(function(){return Zt},"click_loop"),500),Zt=function(t,n){if(![t._USE_CASE,t._USE_CASE_VARIANT,n].every(tn)||!Number.isInteger(t._USE_CASE_VERSION))throw new Error("invalid args");window.loomi.jitsu.track(L.CLICK,{use_case:t._USE_CASE,use_case_variant:t._USE_CASE_VARIANT,version:t._USE_CASE_VERSION,clickId:n})},tn=function(t){return"string"==typeof t&&t.length<40};function nn(){if("undefined"!=typeof window&&!window.vsly_analytics_init){var t=function(){var t={apiKey:"",storeAlias:"",env:0,shouldStart:!1};try{if(window.location.search.includes("lmi_no_init=1"))return t;if(d(function(){return window.loomi_ctx.jitsuKey})){var n=window.loomi_ctx,e=n.jitsuKey,r=n.storeAlias,i=n.env;return{apiKey:e,env:i,storeAlias:r,shouldStart:!!e&&!!i&&!!r}}var o=function(){try{for(var t,n=document.getElementsByTagName("script"),e=function(e){var r=d(function(){return n[e]});if(d(function(){return r.src.includes("https://sdk.loomi-prod.xyz/")})||d(function(){return r.src.includes("https://live.visually-io.com/")})||d(function(){return r.src.includes("https://sdk.loomi-stg.xyz/")}))return t=r,1},r=0;r<n.length&&!e(r);r++);return new URL(t.src)}catch(t){throw a=t,t}}(),c=o.searchParams.get("k"),s=o.searchParams.get("s"),l=parseInt(o.searchParams.get("e")||"");return{apiKey:c,env:l,storeAlias:s,shouldStart:!!c&&!!l&&!!s}}catch(n){return d(function(){return function(t){var n,e=d(function(){return""+t.toString()}),r=d(function(){return""+a.stack}),i=d(function(){return""+a.message});(n=u(),function(t){return n.then(function(){d(function(){return window.loomi.reportSdkErr(t)})})})("vsly script bootstrap failed \n with err: "+e+"\n "+r+"\n "+i)}(n)}),t}}(),n=t.apiKey,e=t.env,i=t.storeAlias;t.shouldStart&&(window.vsly_analytics_init=!0,function(t,n,e){try{return void 0===e&&(e=r.PROD),Promise.resolve(function(i,o){try{var c=(t=$(t),function(t,n,e){m(),window.loomi_ctx.env=window.loomi_ctx.env||t,window.loomi_ctx.storeAlias=window.loomi_ctx.storeAlias||n,e&&(window.loomi_ctx.jitsuKey=window.loomi_ctx.jitsuKey||e)}(e,n,t),function(){try{var t=arguments;return P("kill-proxy")||(function(){if(!Rt){var t=navigator.sendBeacon;navigator.sendBeacon=function(n,e){return jt(n),t.call(this,n,e)},Rt=!0}}(),[].slice.call(t).forEach(function(t){(function(t){try{return Promise.resolve(s(function(){return!!window.XMLHttpRequest})).then(function(){if(window.XMLHttpRequest){var n=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){return this.reqBody=arguments[0],qt(this.reqDomain,this.reqPath,this.reqBody),n.apply(this,arguments)};var e=XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){var n=arguments,r=this,i=Lt(arguments[1]),o=i.domain,c=i.path;this.reqDomain=o,this.reqPath=c,e.apply(this,arguments);try{var a=d(function(){return n[0]}),u=d(function(){return n[1]});this.requestDetails={method:a,url:u,domain:o,path:c},d(function(){return r.addEventListener("load",function(){var n=this,e=this.requestDetails,r=e.method,i=e.domain,o=e.path,c=d(function(){return JSON.parse(n.responseText)},{});t(i,r||"GET",o,this.reqBody,c,"xhr")})})}catch(t){}}}})}catch(t){return Promise.reject(t)}})(t).catch(),function(t){try{return Promise.resolve(s(function(){return!!window.fetch})).then(function(){if(window.fetch){var n=window.fetch;window.fetch=function(){var e=arguments,r=arguments[0],i=d(function(){return e[1]})||{},o=Lt(r),c=o.domain,a=o.path,u=d(function(){return i.body}),s=d(function(){return JSON.parse(u)},u);return qt(c,a,s),n.call(this,r,i).then(function(n){try{if("string"!=typeof r)return n;n.clone().text().then(function(n){var e=d(function(){return JSON.parse(n)},n);t(c,d(function(){return i.method},"GET"),a,s,e,"fetch")}).catch()}catch(t){}return n})}}})}catch(t){return Promise.reject(t)}}(t).catch()})),Promise.resolve()}catch(t){return Promise.reject(t)}}(ct,zt,ut,Ut).then(),Promise.resolve(function(){try{return Promise.resolve(s(function(){return!!d(function(){return!!window.loomi_ctx.userId})},500,101)).then(function(){})}catch(t){return Promise.reject(t)}}()).then(function(){function i(){var i=Ot(),o=function(t,n){return function(t,n){return e={key:t,tracking_host:W(n).trackingHost,analyticsContext:function(){return w({},Ot(),{userCanBeTracked:d(function(){return window.Shopify.customerPrivacy.userCanBeTracked()},!1),userDataCanBeSold:d(function(){return window.Shopify.customerPrivacy.userDataCanBeSold()},!1)})}},(r=new z).init(e),r;var e,r}(t,n)}(t,e);return function(t,n,e){var r=function(t,n){return new E(t,"0.8.318",n,d(function(){return window.loomi_ctx.userId}))}(n,e);d(b),window.loomi=w({},window.loomi||{},{jitsu:t,reportAnalyticsErr:d(function(){return r.withScript("loomi-analytics-sdk")}),reportSdkErr:d(function(){return r.withScript("loomi-sdk")})})}(o,e,n),S()&&function(){d(function(){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.appendChild(document.createTextNode("#preview-bar-iframe { display: none;}")),t.appendChild(n)});var t=document.createElement("script");t.type="text/javascript";var n,e=(void 0===n&&(n=window.loomi_ctx.env),n===r.STAGE?"sdk.loomi-stg.xyz":"live.visually-io.com");t.src="https://"+e+"/preview-widget.js";var i=document.getElementsByTagName("script")[0];d(function(){return i.parentNode.insertBefore(t,i)})}(),function(t){Gt.forEach(clearTimeout),Gt=[],[{s:0,e:10},{s:11,e:30},{s:31,e:60},{s:61,e:180},{s:181,e:600},{s:601,e:1800},{s:1800,e:1e4}].forEach(function(n){Gt.push(setTimeout(function(){t.track(L.TIME_SPENT,n)},1e3*n.s))})}(o),function(t){var n=d(function(){return t.product}),e=d(function(){return t.variant});if(e||n){var r=localStorage.getItem(Jt),i=function(t,n){return{productId:parseInt(d(function(){return t.id})||"0"),variantId:parseInt(d(function(){return n.id})||"0"),handle:d(function(){return window.location.pathname.split("products/")[1]})||""}}(n,e);if(r){var o=JSON.parse(r);(o=o.filter(function(t){return!((n=t).variantId==(e=i).variantId&&n.productId==e.productId);var n,e})).push(i),o.length>20&&o.shift(),Mt(o)}else Mt([i])}}(i),function(t){try{if(d(function(){return!t.line_items.length}))return;var n=JSON.parse(localStorage.getItem(Ht)||"[]"),e=!1;n=d(function(){return n.map(function(n){return d(function(){return n.order_id===t.order_id})?(e=!0,t):n})}),e||(n=[t].concat(n)),localStorage.setItem(Ht,JSON.stringify(n.slice(0,25)))}catch(t){_().error("failed persisting line items",t)}}(function(){var t=window.Shopify;if(!d(function(){return t.checkout}))return{line_items:[]};var n=t.checkout;return{line_items:d(function(){return n.line_items.map(function(t){return{variant_id:d(function(){return t.variant_id.toString()}),product_id:d(function(){return t.product_id.toString()}),price:parseFloat(t.price)||0,quantity:t.quantity}})},[]),order_id:d(function(){return n.order_id.toString()}),created_at:d(function(){return n.created_at.toString()})}}()),location.pathname.includes("/account/")&&s(function(){return!!document.querySelector('form[action="/account"][method="post"]')},1e3,10).then(function(){var t=document.querySelector('form[action="/account"][method="post"]');console.debug("vsly-loyalty","Capturing account form submit",t),t&&t.addEventListener("submit",function(n){try{var e=function(){t.submit()},r=function(t,e){try{var r=(n.preventDefault(),Promise.resolve(Vt()).then(function(){}))}catch(t){return e(t)}return r&&r.then?r.then(void 0,e):r}(0,function(t){console.error("vsly-loyalty","Error tracking signup",t)});return Promise.resolve(r&&r.then?r.then(e):e())}catch(t){return Promise.reject(t)}})}).catch(function(){}),function(t,n){try{var e=d(function(){return new URLSearchParams(n||window.location.search)});if(e){var r=d(function(){return JSON.parse(decodeURIComponent(escape(atob(e.get("vsly-redirected-event")))))});if(r)t.track(r.type,r.payload,r.options);else{if(!sessionStorage)return;var i=d(function(){return JSON.parse(sessionStorage.getItem(e.get("vsly-redirected-from")))});i&&t.track(i.type,i.payload,i.options)}}}catch(t){console.error("vsly-sdk-redirection","Failed to track redirection event",t)}}(o,location.search),Promise.resolve(o.track(L.PAGE_LOAD)).then(function(){var t;It(),window.loomi_ctx.maintainCartAttributes=$t,t=function(){return $t(ot())},s(function(){return!!ot()},500,10).then(t),window.loomi_api=window.loomi_api||{},window.loomi_api.trackClick=Qt})}if(!P("kill-switch")&&!P("kill-tracking")){var o=function(){if(!d(function(){return window.vslyNotShopify}))return Promise.resolve(function(t,n){void 0===t&&(t=100),void 0===n&&(n=100);try{return Promise.resolve(s(function(){return void 0!==window.ShopifyAnalytics},t,n)).then(function(){return"ok"})}catch(t){return Promise.reject(t)}}(100,100)).then(function(){})}();return o&&o.then?o.then(i):i()}}))}catch(t){return o(t)}return c&&c.then?c.then(void 0,o):c}(0,function(t){_().error("vsly","init failed",t),d(function(){return window.loomi.reportAnalyticsErr("init analytics:"+function(t){return l(t)+" stack: "+d(function(){return t.stack},"")}(t)+" , alias: "+n)})}))}catch(t){return Promise.reject(t)}}(n,i,e))}}return nn(),t.bootstrap=nn,t}({});
